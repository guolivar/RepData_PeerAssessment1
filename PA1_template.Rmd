# Reproducible Research: Peer Assessment 1
This assignment makes use of data from a personal activity monitoring device.
This device collects data at 5 minute intervals through out the day. 
The data consists of two months of data from an anonymous individual collected
during the months of October and November, 2012 and include the number of steps 
taken in 5 minute intervals each day.  

### Libraries used for this analysis   

```{r load_libs}
library(ggplot2)

```

## Loading and preprocessing the data

The data available for this assignment is available as a **zip** file and it
needs to be extracted  
```{r extract_data}
# Unzip the file
unzip('./activity.zip')
# load the data
activity.data<-read.csv('./activity.csv')
summary(activity.data)
```

This summary indicates that the `date` field is a date as text but the
`interval` field is a number. These data fields will be converted to a
_POSIXct_ type.  
```{r prep_data}
# Move date field to day field
activity.data$day<-activity.data$date
# Build POSIXct date field
activity.data$date<-as.POSIXct(paste(activity.data$day,
                                     sprintf('%04d',activity.data$interval)),
                                     tz='GMT',format="%Y-%m-%d %H%M")
summary(activity.data)
```

## What is mean total number of steps taken per day?
The data gives steps for 5 minutes intervals, so, daily summaries must be
constructed to estimate the average number of steps per day.  

```{r daily_hist,fig.width=12}
# Calculate total daily steps
daily_summaries<-aggregate( data=activity.data,steps~day, sum)
# Mean daily steps. Rmove NA
me_daily<-mean(daily_summaries$steps,na.rm = TRUE)
# Median daily steps. Rmove NA
md_daily<-median(daily_summaries$steps,na.rm = TRUE)
# Histogram of daily number of steps
hist(daily_summaries$steps,breaks=10,
     main='Daily steps distribution',
     xlab='Number of steps per day',
     ylab='Number of days')
```

The mean number of steps per day were `r me_daily` and the median number of steps per day were `r md_daily`  

## What is the average daily activity pattern?
For this summary we need to aggregate the data by the `interval` field.  
```{r daily_data}
daily.activity<-aggregate( data=activity.data,steps~interval, mean )
ggplot(daily.activity,aes(interval))+
  geom_line(aes(x=interval,y=steps))+
  ggtitle('Average daily activity pattern')+
  ylab('Steps')+
  xlab('Time [HH:MM]')+
  scale_x_continuous(breaks=c(0,600,1200,1800,2400),
                     labels=c('00:00','06:00','12:00','18:00','24:00'))
max_steps<-max(daily.activity$steps)
max_interval<-daily.activity[which.max(daily.activity$steps),1]
```

The maximum average number of steps in a 5 minute interval is `r max_steps` which corresponds to the interval ending at `r sprintf('%04.f',max_interval)` 

## Imputing missing values

### Total number of missing values

```{r missing}
sum(is.na(activity.data$steps))
```

### Filling the missing values
From the analysis so far, it is clear that there is a diurnal pattern on the
number of steps taken during a 5 minute interval. To fill missing values while
minimising the impact on the data, we will use the average and standard
deviation of steps for each 5 minute interval to sample the new values.  

```{r fill_missing}
# New data frame to be filled
filled.activity.data<-activity.data
# Mean number of steps per interval
interval.mean<-aggregate( data=filled.activity.data,steps~interval, mean )
# Standard deviation of number of steps per interval
interval.sd<-aggregate( data=filled.activity.data,steps~interval, sd )

for (int in 1:length(interval.sd[,1]){
  # Number of missing data for this interval
  miss_data<-subset(filled.activity.data,
                    (filled.activity.data$interval==interval.sd[60,1])
                     & (is.na(filled.activity.data$steps)))
  n_miss<-length(miss_data[,1])
  samples<-rnorm(n_miss,interval.mean[int,2],interval.sd[int,2])
  for (idx in 1:n_miss){
   filled.activity.data[activity.data$interval==miss_data$] 
  }
}
```

    Devise a strategy for filling in all of the missing values in the dataset. The strategy does not need to be sophisticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval, etc.

    Create a new dataset that is equal to the original dataset but with the missing data filled in.

    Make a histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?


## Are there differences in activity patterns between weekdays and weekends?
For this part the weekdays() function may be of some help here. Use the dataset with the filled-in missing values for this part.

    Create a new factor variable in the dataset with two levels – “weekday” and “weekend” indicating whether a given date is a weekday or weekend day.

    Make a panel plot containing a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). The plot should look something like the following, which was creating using simulated data:

## System information
The preceeding analysis was performed in the following system:  

```{r sysinfo}
sessionInfo()
```